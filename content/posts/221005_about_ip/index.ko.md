+++
title = '사설IP/공인IP? 사설망/공중망? VPN?'
date = '2022-10-05T17:34:36+09:00'
description = "IPv4 주소 고갈 문제를 해결한 사설망과 NAT, 그리고 VPN의 동작 원리를 쉽게 이해해보자"
summary = "사설 IP와 공인 IP의 차이, NAT(Network Address Translation)의 역할, 그리고 VPN이 어떻게 동작하는지 알아봅니다. IPv4 주소 고갈 문제를 해결한 사설망 개념부터 공유기의 NAT 기능, VPN의 실제 활용 사례까지 네트워크의 핵심 개념을 정리합니다."
categories = ["Network"]
tags = ["IP", "NAT", "VPN", "Network", "사설망", "공인망", "DHCP", "IPv4"]
series = ["Deep Dive into Network"]
series_order = 1

draft = false
+++

{{< lead >}}
사설망과 공중망, 어디선가 들어는 보았지만 개념은 잘 몰랐기에 정리를 해보고자 합니다.
{{< /lead >}}

{{< figure src="featured.jpg" alt="public ip vs private ip" caption="사설 IP와 공인 IP의 관계" >}}

{{< alert "circle-info" >}}
위 그림을 처음 보면 잉? 하겠지만 글을 모두 읽고 나면 아! 하면서 어느 정도 이해를 하실 수 있을 겁니다.
{{< /alert >}}



## 📅 2011년, IPv4 주소 고갈 선언

인터넷 주소 관리기구인 `IANA`(Internet Assigned Numbers Authority)에서는 더 이상의 IPv4의 할당은 없을 것이라고 선언을 하였습니다. IPv4는 대략 **43억 개**의 한정된 주소를 사용할 수 있는데 반해 인터넷의 수요가 빠르게 증가하여 각 대륙에 할당한 IPv4가 동이 나버린 거죠.

{{< alert "lightbulb" >}}
<strong>IANA(Internet Assigned Numbers Authority)</strong>는 인터넷 할당 번호 관리기관의 약자로 IP 주소, 최상위 도메인 등을 관리하는 단체입니다. 현재 ICANN이 관리하고 있습니다.
{{< /alert >}}

### 그런데 어떻게 아직도 IPv4를 사용할까?

그럼 현재 2022년, 무려 11년 전에 동이 나버린 IPv4임에도 불구하고 현재에도 우리는 IPv4를 잘 사용하고 있습니다. 이게 어떻게 된 걸까요?

이 때문에 IPv6가 오래전 개발되어 조금씩 상용화되고 있습니다. 그럼에도 IPv4의 사용이 훨씬 더 많을 텐데 어떻게 11년이 지난 지금까지 잘 유지를 하고 있는 걸까요?

{{< alert "check" >}}
이러한 이유는 <strong>사설망(Private Network)</strong> 덕분입니다.
{{< /alert >}}



## 🔌 사설망(Private Network)이란?

사설망은 IPv4 중 특정 대역을 공인 인터넷이 아닌 가정, 기업 등의 한정된 공간에 사용한 네트워크를 의미합니다. 사설망에 소속된 IP인 **사설 IP 대역**은 오로지 <strong>사설망(내부망)</strong>에서만 사용이 가능하기 때문에 <strong>공인망(외부망, 인터넷)</strong>에선 사용을 할 수 없습니다.

{{< figure src="figure2_ko.png" alt="private ip" caption="사설 IP 대역" class="max-w-4xl" >}}

## {{< icon "globe" >}} 공인 IP란?

인터넷 상에서 서로 다른 PC끼리 통신하기 위해 필요한 IP로써 다음과 같은 용도로 사용됩니다:

- 홈페이지 서버 구축
- PC 인터넷 연결
- 인터넷을 통한 통신

{{< alert "star" >}}
공인 IP는 각 나라마다 관리하는 기관이 있는데, 우리나라는 <strong>한국 인터넷진흥원(KISA)</strong>에서 관리하고 있습니다.
{{< /alert >}}

{{< figure src="figure3.jpeg" alt="public ip" caption="공인 IP 주소 체계" >}}



---

### 💡 개념 정리

{{< alert "circle-info" >}}
사설망은 가정 또는 기업 등의 **한정된 공간에서만 사용이 가능**합니다.
{{< /alert >}}

그럼 우리가 같은 사설망을 사용하지 않는 다른 PC들과 통신하기 위해선 어떻게 해야 할까요?

`공인 IP` 가 필요합니다!

즉, 사설망에서 공인 인터넷 통신을 하기 위해선 **특별한 조치**가 필요합니다. 사설 IP는 사설망에서만 사용하도록 규정이 되어 공인 인터넷에서는 사설 IP를 사용할 수 없는 거죠.

## 🔄 NAT (Network Address Translation)

이에 IP를 변환하기 위한 방법으로 고안된 것이 <strong>네트워크 주소 변환(NAT: Network Address Translation)</strong> 입니다.

{{< alert "lightbulb" >}}
**NAT란?**

IP 패킷의 TCP/UDP 포트 숫자와 소스 및 목적지의 IP 주소 등을 재기록하면서 라우터를 통해 네트워크 트래픽을 주고받는 기술을 말합니다. 패킷에 변화가 생기기 때문에 IP나 <strong>TCP/UDP의 체크섬(checksum)</strong>도 다시 계산되어 재기록해야 합니다.

NAT를 이용하는 이유는 대개 **사설 네트워크에 속한 여러 개의 호스트가 하나의 공인 IP 주소를 사용**하여 인터넷에 접속하기 위함입니다.
{{< /alert >}}

즉, 사설망에서 공인망으로, 공인망에서 사설망으로 통신하고자 할 때 공인망/사설망에서 사용하는 IP로 변환하는 것을 의미합니다. 위 설명에 따르면 IP 패킷의 TCP/UDP 포트 숫자를 변환한다고 하는 것은 실제로 NAT의 의미가 IP 주소뿐만 아니라 Port까지 변환시켜 사용하는 것을 포함하기 때문이라고 하네요!

`PAT` 또는 `NAPT` <strong>(Port Address Translation)</strong>이라고 부릅니다.





## 📡 공유기의 기능

요즘 대부분의 모든 집이 공유기를 (예: iptime, olleh 등) 설치하고 사용하고 있죠.

이 공유기에는 다양한 기능이 존재합니다.

### 1. DHCP 서버 기능

일단 하나의 공유기를 통해 연결된 다양한 기기에 IP를 할당해주는 `DHCP`(Dynamic Host Configuration Protocol) 서버의 기능이 존재합니다.

{{< alert "lightbulb" >}}
<strong>동적 호스트 구성 프로토콜(DHCP)</strong>

DHCP는 호스트 IP 구성 관리를 단순화하는 IP 표준입니다. DHCP 서버를 사용하여 IP 주소 및 관련된 기타 구성 세부 정보를 네트워크의 DHCP 사용 클라이언트에게 **동적으로 할당**하는 방법을 제공합니다.
{{< /alert >}}

이를 통해 공유기에 연결한 집 내부의 스마트 기기 및 PC는 각각의 사설 IP를 할당받게 됩니다.

{{< alert "question-circle" >}}
**왜 사설 IP를 할당받는 걸까요?**

맨 처음 설명으로 돌아가 보면 이해가 되겠죠...?!
{{< /alert >}}

IP 할당 개수는 한정되어 있기 때문에 집집마다, 아니 모든 기기마다 공인 IP를 할당할 수 없으니 **사설 IP를 할당하여 사설망을 구축**하는 거죠! 이렇게 사설망을 구축하여 내부적으로는 통신이 가능하지만 아직 외부 인터넷과는 통신을 할 수 없습니다.

### 2. NAT 기능

그래서 공유기는 **NAT 기능**을 갖추고 있습니다.

- 사설 IP를 공인 IP로 변환하는 기능
- 매핑 테이블을 자체 구축하여 NAT 테이블로 변환 전과 변환 후 값을 관리

{{< alert "star" >}}
물론 공유기가 자체적으로 공인 IP를 갖고 있는 것은 아닙니다! 공유기는 <strong>인터넷 업체(KT, SKT, LG 등)</strong>에서 제공받은 **공인 IP 대역을 사용**하는 것이죠!
{{< /alert >}}



---

## {{< icon "shield" >}} VPN(Virtual Private Network)이란?

그럼 더 나아가 우리가 사용은 해봤을 수 있지만 정확히 어떤 역할을 하는지 잘 모르는 VPN에 대해 알아봅시다!

{{< lead >}}
VPN은 **가상 사설망**으로 이름 그대로 사설망이지만 가상인 사설망을 말합니다.
{{< /lead >}}

{{< alert "fire" >}}
원래 알고 있던 VPN은 뭔가 IP를 변경하거나 IP를 속여 불법... 🤔

그런 건 줄 알고 있었지만 **반은 맞고 반은 틀린** 내용입니다!
{{< /alert >}}

### VPN의 진짜 의미

VPN은 <strong>외부에 있는 컴퓨터에서 내부 네트워크(사설망)에 접속해 있는 것처럼</strong> 사용할 수 있는 것을 말합니다.

VPN을 사용하였을 때 IP가 변경되는 이유도 위의 사설망/공중망을 잘 생각해 보면 이해할 수 있습니다.

{{< alert "check" >}}
VPN을 통해 <strong>내부 네트워크(사설망) 안에 접속</strong>을 하였기 때문에 IP가 변경되는 것이죠!
{{< /alert >}}



### 💼 VPN 활용 사례

#### 1. 재택근무/원격 근무
이를 통해 사설 네트워크가 구축되어 있는 회사에서 VPN 서버 설정을 해주고 외부 공인 IP 주소와 설정된 아이디/비밀번호를 통해 **어디에서든 회사의 사설망에 접근**을 할 수 있는 거죠.

#### 2. 원격 컴퓨터 접속
또한 개인 컴퓨터도 마찬가지로 VPN 설정을 통해 외부 공인 IP 주소만 알아놓고 있으면 어디에서든 VPN을 통해 **서울에 있는 내 컴퓨터를 제주도에서도 접근**할 수 있습니다.

#### 3. 지역 제한 우회
어떤 한 나라의 사이트에서 우리나라 IP로 접속하는 것을 차단했다고 하였을 때 우리는 그 사이트에 접속을 할 수 없습니다. 이 사이트에 접속을 하기 위해서 우리나라가 아닌 다른 나라의 IP 주소로 접근을 해주어야 하는데 이때 VPN을 통해 <strong>다른 나라의 내부 네트워크에 접속한 것처럼</strong> 하여 차단된 방화벽을 통과할 수 있습니다.

#### 4. 방화벽 우회 메커니즘

{{< alert "exclamation-triangle" >}}
**가상 시나리오**

회사에서 내부 규칙으로 회사 근무 중에 SNS에 접속하지 못하도록 차단하였다고 하였을 때 우리는 집에 구축해둔 VPN 또는 해외 VPN을 통해 접속을 해줍니다. 그럼 SNS에 접속을 할 수 있게 됩니다.

{{< /alert >}}


**왜 이러는 걸까요?**

VPN을 연결하는 순간 **가상의 터널**이 형성되고 터널 간의 통신을 위해 보내는 패킷들을 잘게 나누고 **암호화**와 **캡슐화**를 합니다. 이때 회사의 방화벽을 거치게 되지만 암호화/캡슐화된 패킷이기 때문에 내가 VPN을 통해 접속하려는 곳이 SNS인지 알아차리지 못하기 때문에 패킷을 그대로 통과시키게 됩니다.

{{< figure src="figure4.png" alt="vpn" caption="VPN 터널링 구조" >}}


---

## 📋 VPN 정리

### 👍 장점

{{< alert "check" >}}
- {{< icon "lock" >}} **데이터 보안 확보**
- 🔒 **온라인 프라이버시 보호**
- 📍 **IP 주소 변경**
- 🛡️ **신변 보호**
- 🚀 **대역폭 제한 방지**
{{< /alert >}}

### 👎 단점

VPN은 위와 같이 여러 장점도 존재하지만 단점도 존재합니다.

{{< alert "exclamation-triangle" >}}
- 🐢 VPN에 접속한 장비는 VPN 서버와 암호화 통신을 해야 하기 때문에 **네트워크 속도가 매우 느립니다**
- ⚠️ 신뢰성이 낮은 일부 VPN도 존재합니다
- 💰 보안성이 높은 VPN 사용 시에는 **비용을 지불**해야 합니다
- 🚫 일부 국가에서는 **이용이 불가능**합니다
{{< /alert >}}
